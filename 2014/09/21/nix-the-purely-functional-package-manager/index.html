<!doctype html><html lang=en-us><head><title>Nix: çº¯å‡½æ•°å¼åŒ…ç®¡ç†å™¨ - Stone Horse</title><meta http-equiv=x-ua-compatible content="ie=edge"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://hanjianwei.com/style.css></head><body><div class=container><header><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Archives</a></li><li><a href=/tags>Tags</a></li></ul></nav></header><main><div class=post><article><h1>Nix: çº¯å‡½æ•°å¼åŒ…ç®¡ç†å™¨</h1><time>Sep 21, 2014</time><p><p><a href=http://nixos.org/nix/>Nix</a>æ˜¯ä¸€ä¸ªLinux/Unixä¸‹çš„<a href=https://en.wikipedia.org/wiki/Package_management_system>åŒ…ç®¡ç†å™¨</a>ï¼Œå®ƒæ”¯æŒåŸå­å‡çº§å’Œå›æ»šã€èƒ½å¤ŸåŒæ—¶å®‰è£…åŒä¸€ä¸ªåŒ…çš„å¤šä¸ªç‰ˆæœ¬ã€æ”¯æŒå¤šç”¨æˆ·ï¼Œèƒ½å¤Ÿæ›´åŠ ç®€å•åœ°æ­å»ºå¼€å‘ã€æ„å»ºç¯å¢ƒã€‚å®ƒæœ€å¤§çš„å–ç‚¹åœ¨äº <em>å‡½æ•°å¼</em> çš„ç®¡ç†æ–¹å¼ï¼šæŠŠè½¯ä»¶åŒ…ä½œä¸ºå‡½æ•°å¼è¯­è¨€çš„å€¼ï¼Œè¿™äº›å€¼ç”±æ²¡æœ‰å‰¯ä½œç”¨çš„å‡½æ•°æ„å»ºï¼Œä¸€æ—¦æ„å»ºå®Œå°±ä¸å†æ”¹å˜ï¼Œè¿™æ„å‘³ç€ä½ çš„è½¯ä»¶è¿è¡Œç¯å¢ƒä¸€æ—¦æ„å»ºå°±ä¸ä¼šæ”¹å˜â€”â€”è¿™å¯¹äºå¯é‡ç°çš„å¼€å‘è€Œè¨€éå¸¸é‡è¦ã€‚</p><h3 id=å®‰è£…>å®‰è£…</h3><p>å¦‚æœä½ æƒ³å……åˆ†ä½“éªŒNixçš„å¼ºå¤§åŠŸèƒ½ï¼Œå¯ä»¥å®‰è£…<a href=http://nixos.org>NixOS</a>ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ„å»ºäºNixä¹‹ä¸Šçš„Linuxå‘å‹ç‰ˆã€‚</p><p>å¦‚æœä½ ä¸æƒ³è£…ä¸€ä¸ªæ–°çš„ç³»ç»Ÿï¼Œæˆ–è€…åƒæˆ‘ä¸€æ ·ä¸»è¦ç”¨Mac OSXå·¥ä½œï¼Œä¹Ÿå¯ä»¥åªå®‰è£…Nixã€‚æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯åœ¨Terminalé‡Œé¢æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ bash &lt;<span class=o>(</span>curl https://nixos.org/nix/install<span class=o>)</span>
</code></pre></div><p>ç„¶åæŠŠä¸‹é¢è¿™æ®µè„šæœ¬åŠ å…¥åˆ°ä½ çš„shellå¯åŠ¨æ–‡ä»¶ä¸­(<code>~/.zshrc</code>ã€<code>~/.bashrc</code>ç­‰)ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=k>if</span> <span class=o>[</span> -e <span class=nv>$HOME</span>/.nix-profile/etc/profile.d/nix.sh <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
  <span class=nb>source</span> <span class=nv>$HOME</span>/.nix-profile/etc/profile.d/nix.sh<span class=p>;</span>
<span class=k>fi</span>
</code></pre></div><p>ç„¶åå°±å¯ä»¥æŸ¥çœ‹æœ‰ä»€ä¹ˆå¯ç”¨çš„åŒ…ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>
$ nix-env -qa
</code></pre></div><p>å®‰è£…ä¸€ä¸ªåŒ…ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ nix-env -i hello
</code></pre></div><p>å¸è½½ä¸€ä¸ªåŒ…ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ nix-env -e hello
</code></pre></div><p>å‡çº§æ‰€æœ‰çš„åŒ…ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ nix-channel --update nixpkgs
$ nix-env -u <span class=s1>&#39;*&#39;</span>
</code></pre></div><p>å›æ»šä¸Šä¸€æ­¥æ“ä½œï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ nix-env --rollback
</code></pre></div><p>åƒåœ¾å›æ”¶ä¸ç”¨çš„åŒ…ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ nix-collect-garbage -d
</code></pre></div><h3 id=åŒ…ç®¡ç†>åŒ…ç®¡ç†</h3><p>å®‰è£…Nixæ—¶ä¸»è¦åˆ›å»ºäº†ä¸¤ä¸ªç›®å½•ï¼š<code>/nix</code>å’Œ<code>$HOME/.nix-profile</code>ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å®‰è£…çš„åŒ…åˆ°åº•æ˜¯å¦‚ä½•ç»„ç»‡çš„ï¼Œæ¯”å¦‚å½“å‰æœ‰ä¸€ä¸ªåŒ…<code>hello</code>ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ which hello
/Users/hjw/.nix-profile/bin/hello
</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>hello</code>æ¥è‡ªäº<code>$HOME/.nix-profile</code>ï¼Œè€Œåè€…æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œå…¶æŒ‡å‘å¦‚ä¸‹ï¼š</p><p><img src=nix-profile.svg alt="Nix profile"></p><p>è¿›ä¸€æ­¥æŸ¥çœ‹æœ€åä¸€ä¸ªç›®å½•ï¼ˆçœç•¥éƒ¨åˆ†è¾“å‡ºï¼‰ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ ls -l /nix/store/hsw97dr9h9z3wmlwhx2lib8r3k2f9wv3-user-environment
bin
etc -&gt; /nix/store/2vk1g8qkly4aqwx6ks49mzkd5kxhrd5f-nix-1.8pre3766_809ca33/etc
include -&gt; /nix/store/2vk1g8qkly4aqwx6ks49mzkd5kxhrd5f-nix-1.8pre3766_809ca33/include
â€¦â€¦

$ ls -l /nix/store/hsw97dr9h9z3wmlwhx2lib8r3k2f9wv3-user-environment/bin
ccmake -&gt; /nix/store/r5rr3h6fg9sb0vararwh3plm2v9p8hcm-cmake-2.8.12.2/bin/ccmake
cmake -&gt; /nix/store/r5rr3h6fg9sb0vararwh3plm2v9p8hcm-cmake-2.8.12.2/bin/cmake
â€¦â€¦
</code></pre></div><p>å¯ä»¥å‘ç°ï¼Œå®é™…çš„æ–‡ä»¶éƒ½æ˜¯å­˜åœ¨<code>/nix/store</code>ä¸­çš„ã€‚è¿™ä¹Ÿæ˜¯Nixç®¡ç†åŒ…çš„æ–¹å¼ï¼šæ‰€æœ‰çš„åŒ…éƒ½å­˜æ”¾åœ¨<code>/nix/store</code>ä¸­ï¼Œè€Œç”¨æˆ·è®¿é—®çš„éƒ½æ˜¯æŒ‡å‘<code>/nix/store</code>ä¸­æ–‡ä»¶çš„ç¬¦å·é“¾æ¥ã€‚</p><p>Profileæ˜¯Nixç®¡ç†åŒ…çš„æ–¹å¼ï¼Œåœ¨<code>/nix/var/nix/profiles</code>ä¸­ä¿å­˜äº†å½“å‰çš„profileï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ ls -l /nix/var/nix/profiles
default -&gt; default-6-link
default-5-link -&gt; /nix/store/g7l19z0c0ka41irwkn4mz67a0z85xydg-user-environment
default-6-link -&gt; /nix/store/hsw97dr9h9z3wmlwhx2lib8r3k2f9wv3-user-environment
per-user
</code></pre></div><p>å…¶ä¸­<code>default</code>å°±æ˜¯å½“å‰çš„profileã€‚å¦‚æœæˆ‘ä»¬åˆ é™¤ä¸€ä¸ªåŒ…å‘¢ï¼Ÿ</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ nix-env -e hello
uninstalling â€˜hello-2.9â€™
building path<span class=o>(</span>s<span class=o>)</span> â€˜/nix/store/816saagv6v8s19b2sksbgzjj0ljf5qfk-user-environmentâ€™
created <span class=m>62</span> symlinks in user environment

$ ls -l /nix/var/nix/profiles
default -&gt; default-7-link
default-5-link -&gt; /nix/store/g7l19z0c0ka41irwkn4mz67a0z85xydg-user-environment
default-6-link -&gt; /nix/store/hsw97dr9h9z3wmlwhx2lib8r3k2f9wv3-user-environment
default-7-link -&gt; /nix/store/816saagv6v8s19b2sksbgzjj0ljf5qfk-user-environment
per-user
</code></pre></div><p>æ³¨æ„åˆ°åˆ é™¤ä¸€ä¸ªåŒ…ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„profile â€”â€” <code>default-7-link</code>ï¼Œè€Œ<code>default</code>ä¹Ÿä¼šæŒ‡å‘æ–°ç”Ÿæˆçš„profileã€‚è¿™ä¹Ÿæ˜¯Nixçš„å·¥ä½œæ–¹å¼ï¼Œä½ åˆ é™¤åŒ…çš„æ—¶å€™ï¼ŒåŒ…å…¶å®å¹¶æ²¡æœ‰è¢«åˆ é™¤ï¼Œè€Œæ˜¯ç”Ÿæˆäº†ä¸€ä¸ªä¸åŒ…å«åŸæ¥åŒ…çš„æ–°profileï¼è€Œä½ éšæ—¶å¯ä»¥å›åˆ°åŸæ¥çš„çŠ¶æ€ã€‚å¦‚æœæˆ‘ä»¬åæ‚”åˆ é™¤<code>hello</code>äº†ï¼Œé‚£ä¹ˆå¯ä»¥å›æ»šä¸Šè¿°æ“ä½œï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ which hello
hello not found
$ nix-env --rollback
switching from generation <span class=m>7</span> to <span class=m>6</span>
$ which hello
/Users/hjw/.nix-profile/bin/hello
$ ls -l /nix/var/nix/profiles
default -&gt; default-6-link
default-5-link -&gt; /nix/store/g7l19z0c0ka41irwkn4mz67a0z85xydg-user-environment
default-6-link -&gt; /nix/store/hsw97dr9h9z3wmlwhx2lib8r3k2f9wv3-user-environment
default-7-link -&gt; /nix/store/816saagv6v8s19b2sksbgzjj0ljf5qfk-user-environment
per-user
</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œå›æ»šä¹‹å<code>default</code>åˆæŒ‡å‘äº†<code>default-6-link</code>ï¼Œ<code>hello</code>åˆå¯ä»¥ç”¨äº†ã€‚Profileä½¿ç”¨èµ·æ¥éå¸¸çµæ´»ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨å„ä¸ªprofileä¹‹é—´åˆ‡æ¢ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ nix-env --list-generations
   <span class=m>5</span>   2014-09-13 20:58:33
   <span class=m>6</span>   2014-09-19 10:00:58   <span class=o>(</span>current<span class=o>)</span>
   <span class=m>7</span>   2014-09-21 21:16:57
$ nix-env --switch-generation <span class=m>7</span>
switching from generation <span class=m>6</span> to <span class=m>7</span>
$ nix-env --switch-profile /nix/var/nix/profiles/my-profile
$ ls -l ~/.nix-profile
/Users/hjw/.nix-profile -&gt; /nix/var/nix/profiles/my-profile
</code></pre></div><p>å¦‚æœæˆ‘ä»¬ä»æ¥ä¸çœŸæ­£åˆ é™¤åŒ…ï¼Œæ¯«æ— ç–‘é—®ç¡¬ç›˜æ…¢æ…¢å°±ä¼šè¢«å æ»¡ï¼ŒNixæ”¯æŒåƒåœ¾å›æ”¶ã€‚æˆ‘ä»¬éœ€è¦é¦–å…ˆåˆ é™¤ä¸ç”¨çš„profileï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ nix-env --delete-generations <span class=m>5</span>
removing generation <span class=m>5</span>
$ nix-env --delete-generations old
removing generation <span class=m>6</span>
$ nix-env --list-generations
   <span class=m>7</span>   2014-09-21 21:16:57   <span class=o>(</span>current<span class=o>)</span>
</code></pre></div><p>ç„¶åï¼Œå¯ä»¥è¿è¡Œåƒåœ¾å›æ”¶çš„å‘½ä»¤ã€‚è¿™é‡Œçš„åƒåœ¾å›æ”¶è·Ÿç¼–ç¨‹è¯­è¨€çš„åƒåœ¾å›æ”¶æœºåˆ¶å¾ˆåƒï¼Œä¸€ä¸ªåŒ…å¦‚æœæ²¡æœ‰profileç”¨åˆ°å®ƒå°±ä¼šè¢«åˆ é™¤ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ nix-store --gc
</code></pre></div><p>å¦‚æœä½ ä¸ç¡®å®šå“ªäº›ä¸œè¥¿ä¼šè¢«åˆ é™¤ï¼Œå¯ä»¥å…ˆæŠŠè¦åˆ é™¤çš„ä¸œè¥¿æ‰“å°ä¸€ä¸‹çœ‹çœ‹ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ nix-store --gc --print-dead
</code></pre></div><p>è¿˜æœ‰å¦å¤–ä¸€ä¸ªå‘½ä»¤ï¼Œå®ƒä¼šåˆ é™¤<code>/nix/var/nix/profiles</code>ä¸‹æ‰€æœ‰profileçš„è€ç‰ˆæœ¬ï¼Œå¯ä»¥ç”¨æ¥æ¸…ç†ä½ çš„ç³»ç»Ÿï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ nix-collect-garbage -d
</code></pre></div><p>Nixçš„profileå…¶å®æ˜¯å¯ä»¥æ”¾åœ¨ä»»æ„ä½ç½®çš„ï¼Œä½†æ˜¯åƒåœ¾å›æ”¶çš„æ—¶å€™ä¹‹åå›æ”¶<code>/nix/var/nix/gcroots</code>ä¸‹æ‰€æŒ‡å‘çš„é‚£äº›profileç›®å½•ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ ls -l /nix/var/nix/gcroots
auto
profiles -&gt; /nix/var/nix/profiles
</code></pre></div><h3 id=channel>Channel</h3><p>Nixçš„Channelå­˜å‚¨äº†åŒ…çš„é›†åˆï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤æ·»åŠ Channelï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ nix-channel --add http://nixos.org/channels/nixpkgs-unstable
</code></pre></div><p>æ›´æ–°Channel:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ nix-channel --update
</code></pre></div><p>å‡çº§å·²æœ‰çš„åŒ…ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ nix-env -u <span class=s1>&#39;*&#39;</span>
</code></pre></div><p>æ­¤å¤–ï¼ŒNixè¿˜æä¾›äº†å¾ˆæ–¹ä¾¿çš„å·¥å…·è®©ä½ æŠŠåŒ…åŠå…¶ä¾èµ–å¯¼å‡ºã€å¯¼å…¥ä»¥åŠé€šè¿‡SSHæ‹·è´åˆ°å¦ä¸€å°æœºå™¨ä¸Šï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ nix-store --export <span class=k>$(</span>nix-store -qR <span class=k>$(</span><span class=nb>type</span> -p firefox<span class=k>))</span> &gt; firefox.closure
$ nix-store --import &lt; firefox.closure
$ nix-copy-closure --to alice@itchy.example.org <span class=k>$(</span><span class=nb>type</span> -p firefox<span class=k>)</span>
</code></pre></div><h3 id=nixè¡¨è¾¾å¼>Nixè¡¨è¾¾å¼</h3><p>Nixçš„åŒ…æ˜¯ç”±Nixè¡¨è¾¾å¼æè¿°çš„ï¼Œå®ƒæ‰€ä½¿ç”¨çš„<a href=http://nixos.org/nix/manual/#idm47361539226272>Nix expression language</a>æ˜¯ä¸€ç§æ”¯æŒæƒ°æ€§æ±‚å€¼çš„çº¯å‡½æ•°å¼è¯­è¨€ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„<code>hello</code>åŒ…çš„æè¿°ï¼š</p><div class=highlight><pre class=chroma><code class=language-nix data-lang=nix><span class=p>{</span> <span class=n>stdenv</span><span class=o>,</span> <span class=n>fetchurl</span><span class=o>,</span> <span class=n>perl</span> <span class=p>}:</span>

<span class=n>stdenv</span><span class=o>.</span><span class=n>mkDerivation</span> <span class=p>{</span>
  <span class=n>name</span> <span class=o>=</span> <span class=s2>&#34;hello-2.1.v1&#34;</span><span class=p>;</span>
  <span class=n>builder</span> <span class=o>=</span> <span class=sr>./builder.sh</span><span class=p>;</span>
  <span class=n>src</span> <span class=o>=</span> <span class=n>fetchurl</span> <span class=p>{</span>
    <span class=n>url</span> <span class=o>=</span> <span class=sd>ftp://ftp.nluug.nl/pub/gnu/hello/hello-2.1.1.tar.gz</span><span class=p>;</span>
    <span class=n>md5</span> <span class=o>=</span> <span class=s2>&#34;70c9ccvf9fac07f762c24f2df2290784d&#34;</span><span class=p>;</span>
  <span class=p>};</span>
  <span class=k>inherit</span> <span class=n>perl</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p>è¿™ä¸ªæè¿°å…¶å®å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œ<code>{stdenv, fetchurl, perl}</code>æ˜¯å‡½æ•°çš„å‚æ•°ï¼Œè¡¨ç¤ºæ„å»ºè¿™ä¸ªåŒ…éœ€è¦ä»€ä¹ˆä¸œè¥¿ï¼Œ<code>stdenv</code>æä¾›äº†ä¸€ä¸ªæ ‡å‡†çš„æ„å»ºç¯å¢ƒï¼Œ<code>fetchurl</code>é€šè¿‡urlæŠ“å–ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œ<code>perl</code>æ˜¯Perlçš„è§£é‡Šå™¨ã€‚<code>mkDerivation</code>æ˜¯<code>stdenv</code>æä¾›çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒé€šè¿‡ä¸€ä¸ªå±æ€§é›†åˆæ¥æ„å»ºä¸€ä¸ªåŒ…ã€‚<code>mkDerivation</code>çš„å‚æ•°ä¹Ÿå°±æ˜¯åé¢èŠ±æ‹¬å¼§æ‹¬èµ·æ¥çš„é‚£éƒ¨åˆ†æ˜¯ä¸€ä¸ªé›†åˆï¼Œæè¿°äº†è¿™ä¸ªåŒ…çš„å±æ€§ï¼Œå¦‚åå­—ã€æºä»£ç ã€ä»¥åŠæ‰€éœ€çš„è§£é‡Šå™¨ï¼Œå…¶ä¸­çš„<code>builder</code>è¡¨ç¤ºæ„å»ºè¿™ä¸ªåŒ…çš„è„šæœ¬ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>source</span> <span class=nv>$stdenv</span>/setup

<span class=nv>PATH</span><span class=o>=</span><span class=nv>$perl</span>/bin:<span class=nv>$PATH</span>

tar xvfz <span class=nv>$src</span>
<span class=nb>cd</span> hello-*
./configure --prefix<span class=o>=</span><span class=nv>$out</span>
make <span class=m>5</span>
make install
</code></pre></div><p>æ›´å…·ä½“çš„Nix expressionè¿™é‡Œå°±ä¸èµ˜è¿°ï¼Œæœ‰å…´è¶£çš„å¯ä»¥æŸ¥çœ‹ç›¸å…³æ–‡æ¡£ã€‚</p><h3 id=æ€»ç»“>æ€»ç»“</h3><p>Nixæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒå¯ä»¥éå¸¸æ–¹ä¾¿åœ°è§£å†³åŒ…çš„ä¾èµ–ä»¥åŠå¤šç‰ˆæœ¬å…±å­˜çš„é—®é¢˜ï¼Œå¯¹äºé‚£äº›æ²¡æœ‰åŒ…ç®¡ç†ç³»ç»Ÿçš„è¯­è¨€ï¼ˆå¦‚C/C++ï¼‰æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„é€‰æ‹©ï¼›å¯¹äºåŒ…ç®¡ç†å¾ˆå¼±çš„è¯­è¨€ï¼ˆå¦‚Pythonï¼‰ä¹Ÿèƒ½å¤Ÿæä¾›ä¸€ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ³•ï¼›å¯¹äºæ¶‰åŠåˆ°å¤šä¸­è¯­è¨€çš„é¡¹ç›®ï¼Œèƒ½å¤Ÿä»¥ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼æ¥ç®¡ç†å„ç§åŒ…ï¼Œå¯¹å¼€å‘è€…è€Œè¨€æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„å·¥å…·ã€‚</p><p>æ­¤å¤–ï¼ŒNixæ‰€æä¾›çš„åŒ…ç®¡ç†æœºåˆ¶åº”è¯¥å¯ä»¥å’ŒDockerç»“åˆèµ·æ¥ã€‚æ¯”å¦‚æœ¬åœ°å¼€å‘çš„æ—¶å€™ä½¿ç”¨Nixï¼Œå‘å¸ƒæ—¶å°†ç›¸å…³çš„åŒ…æ‰“åŒ…å½¢æˆä¸€ä¸ªDockeré•œåƒï¼Œå®ç°<a href=http://martinfowler.com/bliki/ReproducibleBuild.html>å¯é‡ç°çš„æ„å»º</a>ã€‚</p><p>å¦‚æœè¯´Nixçš„ç¼ºç‚¹ï¼Œé‚£å°±æ˜¯ç›¸æ¯”<code>apt</code>ã€<code>yum</code>ã€<code>pacman</code>ã€<code>homebrew</code>ä¹‹ç±»æ¯”è¾ƒæˆç†Ÿçš„åŒ…ç®¡ç†å™¨ï¼Œå®ƒåŒ…çš„æ•°é‡è¿˜æ¯”è¾ƒå°‘ï¼Œç‰¹åˆ«æ˜¯åœ¨Macä¸Šï¼Œæœ‰å¾ˆå¤šåŒ…è¿˜æ˜¯å¤„äº<code>broken</code>çš„çŠ¶æ€ã€‚ä¸è¿‡Nixçš„å¼€å‘æ¯”è¾ƒæ´»è·ƒï¼Œå³ä½¿ä½ ç°åœ¨è¿˜æ²¡æœ‰ç”¨å®ƒï¼Œä¹Ÿå€¼å¾—å»å…³æ³¨ä¸€ä¸‹ã€‚</p><p>æœ€åè¯´ä¸€å¥ï¼ŒNixå…¶å®ä¹Ÿ<a href=http://nixos.org/wiki/Nix_impurities>ä¸æ˜¯çœŸçš„çº¯å‡½æ•°å¼</a> :-)</p></p></article><aside class=comments><script src=https://utteranc.es/client.js repo=hanjianwei/hanjianwei.github.io issue-term=pathname label=âœ¨ğŸ’¬âœ¨comment theme=github-light crossorigin=anonymous async></script></aside></div></main><footer>&copy; 2013 - 2021 Jianwei Han.
<a href=https://www.github.com/hanjianwei/hanjianwei.github.io/tree/hugo><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2 43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8.0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6 144.1-135.1c5.1-4.7 5.1-12.8.0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"/></svg></a><a href=https://www.github.com/hanjianwei><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8.0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8.0-21.5 4.9-32.3 14.6-51.8 45.3.0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8.0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9.0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2.0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8.0-73.5 38.7-73.5 82.6.0 87.8 80.4 101.3 150.4 101.3h48.2c70.3.0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8.0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg></a><a href=https://twitter.com/hanjianwei><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a><a href=mailto:blog@hanjianwei.com><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V4e2c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5.0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></svg></a><a title="PGP Key" href="https://pgp.mit.edu/pks/lookup?op=get&search=0x309B79EC85BB7488"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="key" class="svg-inline--fa fa-key fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M512 176.001C512 273.203 433.202 352 336 352c-11.22.0-22.19-1.062-32.827-3.069l-24.012 27.014A23.999 23.999.0 01261.223 384H224v40c0 13.255-10.745 24-24 24h-40v40c0 13.255-10.745 24-24 24H24c-13.255.0-24-10.745-24-24v-78.059c0-6.365 2.529-12.47 7.029-16.971l161.802-161.802C163.108 213.814 160 195.271 160 176 160 78.798 238.797.001 335.999.0 433.488-.001 512 78.511 512 176.001zM336 128c0 26.51 21.49 48 48 48s48-21.49 48-48-21.49-48-48-48-48 21.49-48 48z"/></svg></a><a href=/index.xml><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328.0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765.0 183.105.0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686.0 38.981.0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"/></svg></a></footer></div></body></html>