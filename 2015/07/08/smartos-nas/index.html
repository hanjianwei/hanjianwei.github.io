<!doctype html><html lang=en-us><head><title>SmartOSæŠ˜è…¾ç¬”è®° - Stone Horse</title><meta http-equiv=x-ua-compatible content="ie=edge"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://hanjianwei.com/style.css></head><body><div class=container><header><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Archives</a></li><li><a href=/tags>Tags</a></li></ul></nav></header><main><div class=post><article><h1>SmartOSæŠ˜è…¾ç¬”è®°</h1><time>Jul 8, 2015</time><p><p>å‰æ®µæ—¶é—´å…¥æ‰‹äº†ä¸€å°<a href="http://www8.hp.com/us/en/products/proliant-servers/product-detail.html?oid=5379860">Gen8</a>ï¼Œå‡†å¤‡ç”¨åšå®¶é‡Œæ–‡ä»¶ã€åª’ä½“æœåŠ¡å™¨ã€‚çœ‹äº†<a href=https://www.vmware.com/products/vsphere-hypervisor>EXSi</a>ã€<a href=http://www.freenas.org>FreeNAS</a>ã€<a href=http://www.nas4free.org>NAS4Free</a>ã€<a href=https://www.proxmox.com/en/>Proxmox</a>ç­‰æ–¹æ¡ˆåï¼Œè§‰å¾—è¿˜æ˜¯<a href=https://smartos.org>SmartOS</a>æœ€å¥½ã€‚å®ƒæ”¯æŒ<a href=https://en.wikipedia.org/wiki/ZFS>ZFS</a>ï¼Œèƒ½å¤Ÿæ›´å¥½ç®¡ç†æ•°æ®ã€ä¿è¯æ•°æ®æœ‰æ•ˆæ€§ï¼›æ­¤å¤–ï¼Œå®ƒæ”¯æŒ<a href=https://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine>kvm</a>è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œèƒ½å¤Ÿè™šæ‹Ÿå¸¸è§çš„æ“ä½œç³»ç»Ÿï¼Œæ»¡è¶³å„ç§è½¯ä»¶éœ€æ±‚ï¼›å®ƒè¿˜æ”¯æŒç±»ä¼¼Dockerçš„<a href=https://en.wikipedia.org/wiki/Solaris_Containers#Branded_zones>Zones</a>å®¹å™¨æŠ€æœ¯ï¼Œæ¯”kvmæ›´ä¸ºé«˜æ•ˆã€‚</p><h3 id=å®‰è£…é…ç½®>å®‰è£…é…ç½®</h3><p>SmartOSå¯ä»¥è£…åœ¨ä¸€ä¸ªUç›˜é‡Œé¢ã€‚è¿™æ ·çš„å¥½å¤„å¾ˆå¤šï¼Œæ¯”å¦‚å¢åŠ äº†ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ï¼Œå¯ç”¨ç£ç›˜ç©ºé—´ä¹Ÿå¤§äº†ï¼Œç³»ç»Ÿå‡çº§ä¹Ÿå¾ˆç®€å•â€”â€”æ›´æ–°ä¸€ä¸‹Uç›˜å°±è¡Œäº†ã€‚æˆ‘ç”¨äº†ä¸€ä¸ª16Gçš„Uç›˜ï¼ŒæŒ‰ç…§<a href=https://wiki.smartos.org/display/DOC/Creating+a+SmartOS+Bootable+USB+Key>å®˜æ–¹çš„æ•™ç¨‹</a>ä¸‹è½½é•œåƒã€åˆ›å»ºå¯å¯åŠ¨Uç›˜ï¼Œç„¶åä»Uç›˜å¯åŠ¨å°±å¯ä»¥äº†ã€‚</p><p>SmartOSä½¿ç”¨äº†<a href=https://wiki.smartos.org/display/DOC/Zones>zones</a>æŠ€æœ¯ï¼ŒUç›˜å¯åŠ¨åè¿›å…¥ä¸€ä¸ªå…¨å±€çš„zone(Global Zone)ï¼Œè´Ÿè´£ç®¡ç†å…¶å®ƒçš„zoneã€‚ä¸€ä¸ªzoneå°±æ˜¯ä¸€ä¸ªè™šæ‹ŸåŒ–çš„å®ä¾‹ï¼ŒSmartOSåˆ›å»ºçš„æ¯ä¸ªè™šæ‹Ÿæœºéƒ½æ˜¯è·‘åœ¨ä¸€ä¸ªå•ç‹¬çš„zoneé‡Œé¢ã€‚</p><p>SmartOSä½¿ç”¨äº†ZFSæ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€æœ‰è™šæ‹Ÿæœºçš„zoneéƒ½æ˜¯å­˜æ”¾åœ¨ä¸€ä¸ªå«<code>zones</code>çš„zpoolä¸­ã€‚ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œé™¤äº†è®©ä½ é…ç½®ç½‘ç»œï¼Œè¿˜ä¼šè¦æ±‚ä½ åˆ›å»º<code>zones</code>ã€‚æˆ‘æœ‰4å—3Tçš„ç¡¬ç›˜ï¼Œ1å—256Gçš„SSDï¼Œåœ¨å¯åŠ¨æ—¶é€‰æ‹©4å—ç¡¬ç›˜ç»„æˆä¸€ä¸ª<a href=https://blogs.oracle.com/ahl/entry/what_is_raid_z>raidz</a>æ¥ä½œä¸ºzonesæ± ã€‚åœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Œ4å—ç¡¬ç›˜åˆ†åˆ«æ˜¯c1t0d0, c1t1d0, c1t2d0å’Œc1t3d0ã€‚</p><p>ä¸ºäº†å–å¾—æ›´å¥½çš„æ€§èƒ½ï¼Œç”¨<a href=http://docs.oracle.com/cd/E23824_01/html/821-1459/disksprep-10.html>format</a>å°†SSDï¼ˆc1t4d0ï¼‰åˆ†ä¸º32Gå’Œ224Gä¸¤ä¸ªåˆ†åŒºï¼Œåˆ†åˆ«ä½œä¸ºZIL(log)å’ŒL2ARC(cache):</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># zpool add zones log c1t4d0s0</span>
<span class=c1># zpool add zones cache c1t4d0s1</span>
</code></pre></div><p>é…ç½®å®Œä¹‹åç£ç›˜çš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># zpool status</span>
  pool: zones
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        zones       ONLINE       <span class=m>0</span>     <span class=m>0</span>     <span class=m>0</span>
          raidz1-0  ONLINE       <span class=m>0</span>     <span class=m>0</span>     <span class=m>0</span>
            c1t0d0  ONLINE       <span class=m>0</span>     <span class=m>0</span>     <span class=m>0</span>
            c1t1d0  ONLINE       <span class=m>0</span>     <span class=m>0</span>     <span class=m>0</span>
            c1t2d0  ONLINE       <span class=m>0</span>     <span class=m>0</span>     <span class=m>0</span>
            c1t3d0  ONLINE       <span class=m>0</span>     <span class=m>0</span>     <span class=m>0</span>
        logs
          c1t4d0s0  ONLINE       <span class=m>0</span>     <span class=m>0</span>     <span class=m>0</span>
        cache
          c1t4d0s1  ONLINE       <span class=m>0</span>     <span class=m>0</span>     <span class=m>0</span>

errors: No known data errors
</code></pre></div><p>å¦‚æœä¸Šè¿°æ­¥éª¤æé”™äº†ï¼Œå¯ä»¥å‚ç…§<a href=https://wiki.smartos.org/display/DOC/SmartOS+Clean+Re-install>å®˜æ–¹çš„æ­¥éª¤</a>é‡è£…ã€‚å¾ˆä¸å¹¸çš„æ˜¯ï¼Œæˆ‘å®‰è£…å®˜æ–¹çš„æ­¥éª¤é€‰æ‹©Grubç¬¬2é¡¹ï¼ˆnoinstallï¼‰å‡ ä¹æ¯æ¬¡éƒ½ä¼šæ­»æœºï¼Œå¦‚æœä½ é‡åˆ°å’Œæˆ‘ä¸€æ ·çš„æƒ…å†µï¼Œä¹Ÿå¯ä»¥åœ¨å¯åŠ¨æ—¶å‡ºç°Grubç•Œé¢çš„æ—¶å€™ï¼Œåœ¨ç¬¬1é¡¹æŒ‰<code>e</code>ï¼Œç„¶ååœ¨æœ€ååŠ ä¸Š<code>destroy_zpools=true</code>çš„é€‰é¡¹ï¼Œè¿™æ ·å¯åŠ¨åå°±ä¼šåˆ é™¤æ‰€æœ‰çš„zpoolï¼Œç„¶åå°±å¯ä»¥é‡æ–°é…ç½®äº†ã€‚ï¼ˆæ³¨æ„ï¼šç£ç›˜ä¸Šå·²ç»æœ‰æ•°æ®çš„æ…ç”¨ï¼ï¼‰</p><h3 id=åˆ›å»ºè™šæ‹Ÿæœº>åˆ›å»ºè™šæ‹Ÿæœº</h3><p>Uç›˜å¯åŠ¨çš„SmartOSæ˜¯ä¸€ä¸ªåªè¯»ç³»ç»Ÿï¼Œä½ æ‰€èƒ½åšçš„äº‹æƒ…éå¸¸æœ‰é™ã€‚ä¸è¿‡SmartOSå°±æ˜¯ä¸ºè™šæ‹ŸåŒ–è€Œç”Ÿçš„ï¼Œå®ƒæ”¯æŒzoneså’Œkvmä¸¤ç§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå‰è€…ç±»ä¼¼å®¹å™¨æŠ€æœ¯ï¼Œå…·æœ‰å¾ˆå¥½çš„æ€§èƒ½ï¼Œä½†æ”¯æŒçš„OSè¾ƒå°‘ï¼›åè€…æ€§èƒ½ä¸å¦‚å‰è€…ï¼Œä½†èƒ½æ”¯æŒå¤§éƒ¨åˆ†å¸¸è§çš„OSã€‚</p><p><code>imgadm</code>å’Œ<code>vmadm</code>æ˜¯ç®¡ç†è™šæ‹Ÿæœºçš„ä¸¤ä¸ªå¸¸ç”¨å‘½ä»¤ï¼Œå‰è€…ä¸»è¦ç”¨æ¥ç®¡ç†é•œåƒï¼Œè€Œåè€…ç”¨æ¥ç®¡ç†è™šæ‹Ÿæœºã€‚ä½ å¯ä»¥é€šè¿‡<code>imgadm avail</code>æ¥æŸ¥çœ‹å·²æœ‰çš„è™šæ‹Ÿæœºé•œåƒï¼Œç”¨<code>vmadm create</code>æ¥æ ¹æ®é•œåƒåˆ›å»ºè™šæ‹Ÿæœºã€‚</p><p>æ­¤å¤–ï¼Œæˆ‘å¸Œæœ›æ•°æ®èƒ½å¤Ÿå•ç‹¬å­˜å‚¨ï¼Œå³ä½¿è™šæ‹Ÿæœºåæ‰æˆ–è€…åˆ é™¤æ•°æ®ä»ç„¶å­˜åœ¨ï¼Œå› æ­¤ä¸“é—¨å»ºç«‹ä¸€ä¸ªæ•°æ®å­˜å‚¨çš„datasetï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># zfs create zones/datastore</span>
</code></pre></div><h4 id=kvmè™šæ‹Ÿæœº>kvmè™šæ‹Ÿæœº</h4><p>kvmæ˜¯ä»linuxç§»æ¤è¿‡æ¥çš„æŠ€æœ¯ï¼Œèƒ½æ”¯æŒå¤§éƒ¨åˆ†å¸¸è§çš„æ“ä½œç³»ç»Ÿï¼Œåœ¨åˆ›å»ºkvmè™šæ‹Ÿæœºä¹‹å‰é¦–å…ˆè¦åˆ›å»ºæˆ–ä¸‹è½½ç›¸åº”çš„é•œåƒã€‚Joyentå·²ç»æä¾›äº†å¾ˆå¤šå¸¸è§çš„é•œåƒï¼Œå¦‚æœæˆ‘æƒ³è£…ä¸€ä¸ªdebian 8ï¼Œå¯ä»¥é¦–å…ˆè¿›è¡Œæœç´¢ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># imgadm avail | grep debian-8</span>
ca291f66-048c-11e5-98b3-c3f2a972a4cc  debian-8                <span class=m>20150527</span>    linux    2015-05-27T16:24:03Z
2f56d126-20d0-11e5-9e5b-5f3ef6688aba  debian-8                <span class=m>20150702</span>    linux    2015-07-02T15:37:02Z
</code></pre></div><p>ç„¶åå¯ä»¥é€‰æ‹©éœ€è¦çš„é•œåƒè¿›è¡Œä¸‹è½½ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># imgadm import 2f56d126-20d0-11e5-9e5b-5f3ef6688aba</span>
</code></pre></div><p>åˆ›å»ºè™šæ‹Ÿæœºæ—¶ï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªJSONæ ¼å¼çš„è™šæ‹Ÿæœºæè¿°æ–‡ä»¶ï¼Œä¸‹é¢æ˜¯debian 8çš„æè¿°æ–‡ä»¶ï¼Œä¸»è¦æ˜¯ç½‘ç»œè®¾ç½®ä»¥åŠé•œåƒè®¾ç½®ï¼š</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=p>{</span>
  <span class=s2>&#34;brand&#34;</span><span class=o>:</span> <span class=s2>&#34;kvm&#34;</span><span class=p>,</span>
  <span class=s2>&#34;alias&#34;</span><span class=o>:</span> <span class=s2>&#34;debian&#34;</span><span class=p>,</span>
  <span class=s2>&#34;hostname&#34;</span><span class=o>:</span> <span class=s2>&#34;debian&#34;</span><span class=p>,</span>
  <span class=s2>&#34;resolvers&#34;</span><span class=o>:</span> <span class=p>[</span>
    <span class=s2>&#34;192.168.1.1&#34;</span><span class=p>,</span>
    <span class=s2>&#34;114.114.114.114&#34;</span><span class=p>,</span>
    <span class=s2>&#34;8.8.8.8&#34;</span><span class=p>,</span>
    <span class=s2>&#34;8.8.4.4&#34;</span>
  <span class=p>],</span>
  <span class=s2>&#34;ram&#34;</span><span class=o>:</span> <span class=s2>&#34;2048&#34;</span><span class=p>,</span>
  <span class=s2>&#34;vcpus&#34;</span><span class=o>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span>
  <span class=s2>&#34;nics&#34;</span><span class=o>:</span> <span class=p>[</span>
    <span class=p>{</span>
      <span class=s2>&#34;nic_tag&#34;</span><span class=o>:</span> <span class=s2>&#34;admin&#34;</span><span class=p>,</span>
      <span class=s2>&#34;ip&#34;</span><span class=o>:</span> <span class=s2>&#34;192.168.1.102&#34;</span><span class=p>,</span>
      <span class=s2>&#34;netmask&#34;</span><span class=o>:</span> <span class=s2>&#34;255.255.255.0&#34;</span><span class=p>,</span>
      <span class=s2>&#34;gateway&#34;</span><span class=o>:</span> <span class=s2>&#34;192.168.1.1&#34;</span><span class=p>,</span>
      <span class=s2>&#34;model&#34;</span><span class=o>:</span> <span class=s2>&#34;virtio&#34;</span><span class=p>,</span>
      <span class=s2>&#34;primary&#34;</span><span class=o>:</span> <span class=kc>true</span>
    <span class=p>}</span>
  <span class=p>],</span>
  <span class=s2>&#34;disks&#34;</span><span class=o>:</span> <span class=p>[</span>
    <span class=p>{</span>
      <span class=s2>&#34;image_uuid&#34;</span><span class=o>:</span> <span class=s2>&#34;2f56d126-20d0-11e5-9e5b-5f3ef6688aba&#34;</span><span class=p>,</span>
      <span class=s2>&#34;boot&#34;</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
      <span class=s2>&#34;model&#34;</span><span class=o>:</span> <span class=s2>&#34;virtio&#34;</span>
    <span class=p>}</span>
  <span class=p>]</span>
<span class=p>}</span>
</code></pre></div><p>å…·ä½“çš„å¯ç”¨é€‰é¡¹å¯ä»¥æŸ¥çœ‹<code>vmadm</code>çš„<a href=https://github.com/joyent/smartos-live/blob/master/src/vm/man/vmadm.1m.md>æ–‡æ¡£</a>ä»¥åŠSmartOSçš„<a href=https://wiki.smartos.org/display/DOC/How+to+create+a+KVM+VM+%28+Hypervisor+virtualized+machine+%29+in+SmartOS>wiki</a>ã€‚</p><p>å°†æ–‡ä»¶å­˜ä¸º<code>debian8.json</code>ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡<code>vmadm</code>åˆ›å»ºé•œåƒï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># vmadm create -f debian8.json </span>
Successfully created VM b94d3a92-4a3b-4fae-baca-e53c726be924
</code></pre></div><p>å¯ä»¥é€šè¿‡<code>vmadm list</code>æ¥æŸ¥çœ‹å½“å‰è™šæ‹Ÿæœºçš„çŠ¶æ€ã€‚åˆ›å»ºå¥½çš„è™šæ‹Ÿæœºå¯ä»¥é€šè¿‡VNCç™»å½•ï¼Œé¦–å…ˆè¦æŸ¥çœ‹è™šæ‹Ÿæœºçš„VNCä¿¡æ¯ï¼Œç„¶åé€šè¿‡ipå’Œç«¯å£è¿›è¡Œç™»å½•ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># vmadm info b94d3a92-4a3b-4fae-baca-e53c726be924 vnc</span>
<span class=o>{</span>
  <span class=s2>&#34;vnc&#34;</span>: <span class=o>{</span>
    <span class=s2>&#34;host&#34;</span>: <span class=s2>&#34;192.168.1.100&#34;</span>,
    <span class=s2>&#34;port&#34;</span>: 57869,
    <span class=s2>&#34;display&#34;</span>: <span class=m>51969</span>
  <span class=o>}</span>
<span class=o>}</span>
</code></pre></div><p>æˆ‘ä»¬å¸Œæœ›åœ¨è™šæ‹Ÿæœºä¸­è®¿é—®<code>datastore</code>ï¼Œå¹¶å°†é‡è¦çš„æ•°æ®å­˜åœ¨å…¶ä¸­ï¼Œè¿™æ ·å³ä½¿è™šæ‹ŸæœºæŒ‚æ‰ä¹Ÿä¸å½±å“æ•°æ®çš„è®¿é—®ã€‚å¯ä»¥é€šè¿‡<a href=https://wiki.smartos.org/display/DOC/Configuring+NFS+in+SmartOS>NFS</a>æ¥è¿›è¡Œæ–‡ä»¶æ­å–œã€‚é¦–å…ˆå°†<code>datastore</code>å…±äº«ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># zfs set sharenfs=&#39;rw=@192.168.1.0/24,root=192.168.1.102&#39; zones/datastore</span>
</code></pre></div><p>åœ¨debiané‡Œé¢å®‰è£…nfsç›¸å…³çš„åŒ…å¹¶å°†datastoreæŒ‚è½½è¿‡å»ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># apt-get update &amp;&amp; apt-get install nfs-common</span>
<span class=c1># mkdir -p /mnt/datastore &amp;&amp; mount -o rw,async,hard,intr 192.168.1.100:/zones/datastore /mnt/datastore</span>
</code></pre></div><p>åœ¨debianè™šæ‹Ÿæœºä¸­å°±å¯ä»¥å°†å¸¸ç”¨æ•°æ®æ”¾åœ¨/mnt/datastoreä¸­äº†ã€‚</p><h4 id=zone>zone</h4><p>Zoneæ˜¯ä¸€ç§æ›´é«˜æ•ˆçš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œä½†æ˜¯å®ƒé€‚ç”¨çš„OSä¹Ÿæ¯”è¾ƒæœ‰é™ã€‚æ¯”å¦‚ä½ å¦‚æœæƒ³ç©ç©SmartOSï¼Œé‚£ç”¨Global Zoneçš„ç³»ç»Ÿå¯èƒ½ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒæ˜¯åªè¯»çš„ï¼Œè€Œä¸”ç¼ºå°‘åŒ…ç®¡ç†ç­‰å·¥å…·ã€‚æˆ‘ä»¬å¯ä»¥ç”¨zoneè™šæ‹Ÿä¸€ä¸ªSmartOSï¼Œä½ å¯ä»¥ç”¨<code>imgadm</code>æœç´¢å¹¶ä¸‹è½½<code>base64</code>é•œåƒï¼Œå¹¶é€šè¿‡ä¸‹é¢çš„JSONæ–‡ä»¶æ¥åˆ›å»ºè™šæ‹Ÿæœºï¼š</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=p>{</span>
  <span class=s2>&#34;brand&#34;</span><span class=o>:</span> <span class=s2>&#34;joyent&#34;</span><span class=p>,</span>
  <span class=s2>&#34;image_uuid&#34;</span><span class=o>:</span> <span class=s2>&#34;62f148f8-6e84-11e4-82c5-efca60348b9f&#34;</span><span class=p>,</span>
  <span class=s2>&#34;alias&#34;</span><span class=o>:</span> <span class=s2>&#34;smartos&#34;</span><span class=p>,</span>
  <span class=s2>&#34;hostname&#34;</span><span class=o>:</span> <span class=s2>&#34;smartos&#34;</span><span class=p>,</span>
  <span class=s2>&#34;max_physical_memory&#34;</span><span class=o>:</span> <span class=mi>2048</span><span class=p>,</span>
  <span class=s2>&#34;quota&#34;</span><span class=o>:</span> <span class=mi>20</span><span class=p>,</span>
  <span class=s2>&#34;resolvers&#34;</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;192.168.1.1&#34;</span><span class=p>,</span> <span class=s2>&#34;114.114.114.114&#34;</span><span class=p>,</span> <span class=s2>&#34;8.8.8.8&#34;</span><span class=p>,</span> <span class=s2>&#34;8.8.4.4&#34;</span><span class=p>],</span>
  <span class=s2>&#34;nics&#34;</span><span class=o>:</span> <span class=p>[</span>
    <span class=p>{</span>
      <span class=s2>&#34;nic_tag&#34;</span><span class=o>:</span> <span class=s2>&#34;admin&#34;</span><span class=p>,</span>
      <span class=s2>&#34;ip&#34;</span><span class=o>:</span> <span class=s2>&#34;192.168.1.101&#34;</span><span class=p>,</span>
      <span class=s2>&#34;netmask&#34;</span><span class=o>:</span> <span class=s2>&#34;255.255.255.0&#34;</span><span class=p>,</span>
      <span class=s2>&#34;gateway&#34;</span><span class=o>:</span> <span class=s2>&#34;192.168.1.1&#34;</span>
    <span class=p>}</span>
  <span class=p>]</span>
<span class=p>}</span>
</code></pre></div><p>ç„¶åï¼Œç”¨<code>vmadm</code>æ¥åˆ›å»ºè™šæ‹Ÿæœºã€‚å’Œkvmä¸åŒçš„æ˜¯ï¼Œè¿™ç§æ–¹å¼åˆ›å»ºçš„è™šæ‹Ÿæœºä¸èƒ½ç”¨VNCç™»å½•ï¼Œä½†æ˜¯å¯ä»¥ç”¨zloginæ¥ç™»å½•ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># vmadm create -f smartos.json </span>
Successfully created VM 0b3c7b3b-9f19-4d26-ab22-a8b10a9add25
<span class=c1># zlogin 0b3c7b3b-9f19-4d26-ab22-a8b10a9add25 </span>
<span class=o>[</span>Connected to zone <span class=s1>&#39;0b3c7b3b-9f19-4d26-ab22-a8b10a9add25&#39;</span> pts/2<span class=o>]</span>
   __        .                   .
 _<span class=p>|</span>  <span class=p>|</span>_      <span class=p>|</span> .-. .  . .-. :--. <span class=p>|</span>-
<span class=p>|</span>_    _<span class=p>|</span>     <span class=p>;|</span>   <span class=o>||</span>  <span class=p>|</span><span class=o>(</span>.-<span class=s1>&#39; |  | |
</span><span class=s1>  |__|   `--&#39;</span>  <span class=sb>`</span>-<span class=s1>&#39; `;-| `-&#39;</span> <span class=s1>&#39;  &#39;</span> <span class=sb>`</span>-<span class=s1>&#39;
</span><span class=s1>                   /  ; Instance (base64 14.3.0)
</span><span class=s1>                   `-&#39;</span>  http://wiki.joyent.com/jpc2/Base+Instance
</code></pre></div><p>Zoneä¸åªæ˜¯æ”¯æŒSmartOSï¼Œå®ƒè¿˜æ”¯æŒ<a href=https://wiki.smartos.org/display/DOC/LX+Branded+Zones>LX Branded Zones</a>ï¼Œå…è®¸ä½ åœ¨zoneé‡Œé¢ç›´æ¥è¿è¡Œlinuxã€‚<code>imgadm avail</code>ä¸­åˆ—å‡ºçš„é•œåƒä¸­ä»¥<code>lx-</code>å¼€å¤´çš„æ”¯æŒLX Branded Zonesã€‚æ­¤å¤–ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•åˆ›å»ºè™šæ‹Ÿæœºæ—¶ï¼Œä¸å¿…ç”¨NFSæ¥å…±äº«æ•°æ®ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡<code>filesystems</code>å­—æ®µæ¥æŒ‡å®šç›®å½•æ˜ å°„ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª<code>lx-ubuntu-14.04</code>çš„ä¾‹å­ï¼š</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=p>{</span>
  <span class=s2>&#34;brand&#34;</span><span class=o>:</span> <span class=s2>&#34;lx&#34;</span><span class=p>,</span>
  <span class=s2>&#34;alias&#34;</span><span class=o>:</span> <span class=s2>&#34;ubuntu1404&#34;</span><span class=p>,</span>
  <span class=s2>&#34;kernel_version&#34;</span><span class=o>:</span> <span class=s2>&#34;3.13.0&#34;</span><span class=p>,</span>
  <span class=s2>&#34;max_physical_memory&#34;</span><span class=o>:</span> <span class=mi>2048</span><span class=p>,</span>
  <span class=s2>&#34;image_uuid&#34;</span><span class=o>:</span> <span class=s2>&#34;a21a64a0-0809-11e5-a64f-ff80e8e8086f&#34;</span><span class=p>,</span>
  <span class=s2>&#34;resolvers&#34;</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;192.168.1.1&#34;</span><span class=p>,</span><span class=s2>&#34;114.114.114.114&#34;</span><span class=p>,</span><span class=s2>&#34;8.8.8.8&#34;</span><span class=p>,</span><span class=s2>&#34;8.8.4.4&#34;</span><span class=p>],</span>
  <span class=s2>&#34;nics&#34;</span><span class=o>:</span> <span class=p>[</span>
    <span class=p>{</span>
      <span class=s2>&#34;nic_tag&#34;</span><span class=o>:</span> <span class=s2>&#34;admin&#34;</span><span class=p>,</span>
      <span class=s2>&#34;ip&#34;</span><span class=o>:</span> <span class=s2>&#34;192.168.1.103&#34;</span><span class=p>,</span>
      <span class=s2>&#34;netmask&#34;</span><span class=o>:</span> <span class=s2>&#34;255.255.255.0&#34;</span><span class=p>,</span>
      <span class=s2>&#34;gateway&#34;</span><span class=o>:</span> <span class=s2>&#34;192.168.1.1&#34;</span><span class=p>,</span>
      <span class=s2>&#34;primary&#34;</span><span class=o>:</span> <span class=kc>true</span>
    <span class=p>}</span>
  <span class=p>],</span>
  <span class=s2>&#34;filesystems&#34;</span><span class=o>:</span> <span class=p>[</span>
    <span class=p>{</span>
      <span class=s2>&#34;type&#34;</span><span class=o>:</span> <span class=s2>&#34;lofs&#34;</span><span class=p>,</span>
      <span class=s2>&#34;source&#34;</span><span class=o>:</span> <span class=s2>&#34;zones/datastore&#34;</span><span class=p>,</span>
      <span class=s2>&#34;target&#34;</span><span class=o>:</span> <span class=s2>&#34;/mnt/datastore&#34;</span>
    <span class=p>}</span>
  <span class=p>]</span>
<span class=p>}</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç›´æ¥å°†Global Zoneçš„<code>zones/datastore</code>æ˜ å°„åˆ°è™šæ‹Ÿæœºçš„<code>/mnt/datastore</code>ã€‚ç„¶åå°±å¯ä»¥é€šè¿‡zloginè¿›è¡Œç™»å½•ï¼Œè®¾ç½®å¥½sshåä¹Ÿå¯ä»¥é€šè¿‡sshè¿œç¨‹ç™»å½•ã€‚</p><p>SmartOSç¡®å®æ˜¯ä¸€ä¸ªå¾ˆé€‚åˆNASçš„ç³»ç»Ÿï¼Œè¿˜æœ‰æ›´å¤šçš„ç‰¹æ€§æœ‰å¾…å‘æ˜ã€‚</p></p></article><aside class=comments><script src=https://utteranc.es/client.js repo=hanjianwei/hanjianwei.github.io issue-term=pathname label=âœ¨ğŸ’¬âœ¨comment theme=github-light crossorigin=anonymous async></script><div id=disqus_thread></div><script>var disqus_shortname='hjwblog';var disqus_identifier='\/2015\/07\/08\/smartos-nas\/';(function(){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></aside></div></main><footer>&copy; 2013 - 2020 Jianwei Han.
<a href=https://www.github.com/hanjianwei/hanjianwei.github.io/tree/hugo><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2 43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8.0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6 144.1-135.1c5.1-4.7 5.1-12.8.0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"/></svg></a><a href=https://www.github.com/hanjianwei><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8.0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8.0-21.5 4.9-32.3 14.6-51.8 45.3.0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8.0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9.0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2.0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8.0-73.5 38.7-73.5 82.6.0 87.8 80.4 101.3 150.4 101.3h48.2c70.3.0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8.0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg></a><a href=https://twitter.com/hanjianwei><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a><a href=mailto:blog@hanjianwei.com><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V4e2c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5.0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></svg></a><a title="PGP Key" href="https://pgp.mit.edu/pks/lookup?op=get&search=0x309B79EC85BB7488"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="key" class="svg-inline--fa fa-key fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M512 176.001C512 273.203 433.202 352 336 352c-11.22.0-22.19-1.062-32.827-3.069l-24.012 27.014A23.999 23.999.0 01261.223 384H224v40c0 13.255-10.745 24-24 24h-40v40c0 13.255-10.745 24-24 24H24c-13.255.0-24-10.745-24-24v-78.059c0-6.365 2.529-12.47 7.029-16.971l161.802-161.802C163.108 213.814 160 195.271 160 176 160 78.798 238.797.001 335.999.0 433.488-.001 512 78.511 512 176.001zM336 128c0 26.51 21.49 48 48 48s48-21.49 48-48-21.49-48-48-48-48 21.49-48 48z"/></svg></a><a href=/index.xml><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328.0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765.0 183.105.0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686.0 38.981.0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"/></svg></a></footer></div></body></html>